---
$class: !freestyle
kind: !freestyle # TODO(schroederc): remove duplicate kind/staper-class lines
                 #                   once Leeroy has pushed kind syntax change
label: &LABEL google/cloud-dev-java:prod
hasSlaveAffinity: true        # TODO(schroederc): remove these lines once Leeroy has
_.assignedLabelString: *LABEL #                   pushed label syntax upgrade
builder:
- $class: !shell
  kind: !shell
  command: ./jenkins/docker-pull.sh google/kythe-campfire:latest
- $class: !shell
  kind: !shell
  command: |
    #!/bin/bash -e
    ./campfire-docker --non-interactive build //...
    ./campfire-docker --non-interactive test //...
- $class: !shell
  kind: !shell
  command: |
    #!/bin/bash -e
    mkdir "schema_${BUILD_ID}"
    cp campfire-out/doc/kythe/docs/schema/*.{svg,html} "schema_${BUILD_ID}/"
publisher:
  $class: !by-name Google Cloud Storage Uploader
  kind: !by-name Google Cloud Storage Uploader
  credentialsId: kythe-repo
  uploads:
  - $class: !by-name Classic Upload
    stapler-class: !by-name Classic Upload
    sourceGlobWithVars: schema_${BUILD_ID}/
    bucketNameWithVars: gs://kythe-builds/